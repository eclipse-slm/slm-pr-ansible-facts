---
- name: "Create inventory with target host(s)"
  hosts: localhost
  connection: local
  gather_facts: true
  tasks:
    - name: Use inventory Helper to setup ansible inventory
      ansible.builtin.include_role:
        name: profiler-inventory-helper
    - name: Union Node
      ansible.builtin.set_fact:
        nodes: "{{ nodes | union(nodes) }}"

# gather_facts:
- name: Gather facts from util server
  hosts: all
  gather_facts: true

- name: "Add Service to facts"
  hosts: localhost
  tasks:

    - name: Set aas_repository
      ansible.builtin.set_fact:
        aas_repository_host: "aas-repository"
        aas_repository_port: 8081
      when: (aas_repository_host is not defined) or (aas_repository_host | length == 0)

    - name: Set aas_registry
      ansible.builtin.set_fact:
        aas_registry_host: "aas-registry"
        aas_registry_port: 8082
      when: (aas_registry_host is not defined) or (aas_registry_host | length == 0)

    - name: Set submodel_registry
      ansible.builtin.set_fact:
        submodel_registry_host: "submodel-registry"
        submodel_registry_port: 8083
      when: (submodel_registry_host is not defined) or (submodel_registry_host | length == 0)

    - name: "Include ansible-facts"
      ansible.builtin.include_role:
        name: "ansible-facts"
      with_items: nodes

# local fansible facts hostvars['{{hosts }}']

#- name: Run ansible-facts profiler
#  hosts: all
#  gather_facts: no
#  become: yes
#  tasks:
#    - name: Assert input parameter
#      ansible.builtin.assert:
#        that:
#          - (resource_id is defined) and (resource_id | length > 0)
#
#    - name: Print all available facts
#      ansible.builtin.debug:
#        var: ansible_facts
#
#    - name: Print aas_repository_host
#      ansible.builtin.debug:
#        msg: "{{ aas_repository_host}} : {{ aas_repository_port}}"
#
#    - name: Print aas_registry_host
#      ansible.builtin.debug:
#        msg: "{{ aas_registry_host}}: {{ aas_registry_port}}"
#
#    - name: Print submodel_registry_host
#      ansible.builtin.debug:
#        msg: "{{ submodel_registry_host}}: {{ submodel_registry_port}}"
#
#    - name: Set aas_id
#      ansible.builtin.set_fact:
#        aas_id: "{{ resource_id }}"
#
#    - name: Set aas_repository
#      ansible.builtin.set_fact:
#        aas_repository_host: "aas-repository"
#        aas_repository_port: 8081
#      when: (aas_repository_host is not defined) or (aas_repository_host | length == 0)
#
#    - name: Set aas_registry
#      ansible.builtin.set_fact:
#        aas_registry_host: "aas-registry"
#        aas_registry_port: 8082
#      when: (aas_registry_host is not defined) or (aas_registry_host | length == 0)
#
#    - name: Set submodel_registry
#      ansible.builtin.set_fact:
#        submodel_registry_host: "submodel-registry"
#        submodel_registry_port: 8083
#      when: (submodel_registry_host is not defined) or (submodel_registry_host | length == 0)
#
#    - name: "Include ansible-facts"
#      ansible.builtin.include_role:
#        name: "ansible-facts"